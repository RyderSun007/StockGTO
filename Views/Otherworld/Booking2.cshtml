@{
    ViewData["Title"] = "DIY 團體預約系統 (設計版)";
    Layout = null; // 不用 Layout
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<div class="container my-5">
    <h2 class="mb-4">📋 DIY 團體預約系統 (設計版)</h2>

    <div class="card mb-4">
        <div class="card-body">

            <!-- 日期 / 地區 -->
            <div class="row mb-3">
                <div class="col-md-3">
                    <label class="form-label">選擇日期：</label>
                    <input type="date" id="date" class="form-control" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">地區：</label>
                    <input type="text" id="area" class="form-control" placeholder="請輸入地區" />
                </div>
            </div>

            <!-- 一般票 -->
            <h5 class="mt-4">🎫 一般票</h5>
            <table class="table table-bordered text-center align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>票種</th>
                        <th>票價</th>
                        <th>預約張數</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>一般票</td>
                        <td>$250</td>
                        <td><input type="number" min="0" value="0" id="normalCount" class="form-control" /></td>
                    </tr>
                    <tr>
                        <td>優待票</td>
                        <td>$200</td>
                        <td><input type="number" min="0" value="0" id="discountCount" class="form-control" /></td>
                    </tr>
                </tbody>
            </table>

            <!-- DIY 體驗票 -->
            <h5 class="mt-4">🍫 DIY 體驗票 (分時段)</h5>
            <table class="table table-bordered text-center align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>時段</th>
                        <th>剩餘名額</th>
                        <th>預約張數</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>09:00</td>
                        <td id="remain_09">100</td>
                        <td><input type="number" min="0" value="0" class="form-control" data-time="09:00" /></td>
                    </tr>
                    <tr>
                        <td>11:00</td>
                        <td id="remain_11">80</td>
                        <td><input type="number" min="0" value="0" class="form-control" data-time="11:00" /></td>
                    </tr>
                    <tr>
                        <td>13:00</td>
                        <td id="remain_13">90</td>
                        <td><input type="number" min="0" value="0" class="form-control" data-time="13:00" /></td>
                    </tr>
                    <tr>
                        <td>15:00</td>
                        <td id="remain_15">75</td>
                        <td><input type="number" min="0" value="0" class="form-control" data-time="15:00" /></td>
                    </tr>
                    <tr>
                        <td>17:00</td>
                        <td id="remain_17">60</td>
                        <td><input type="number" min="0" value="0" class="form-control" data-time="17:00" /></td>
                    </tr>
                    <tr>
                        <td>19:00</td>
                        <td id="remain_19">50</td>
                        <td><input type="number" min="0" value="0" class="form-control" data-time="19:00" /></td>
                    </tr>
                </tbody>
            </table>

            <!-- 其他資料 -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">姓名：</label>
                    <input type="text" id="userName" class="form-control" placeholder="請輸入姓名" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">電話：</label>
                    <input type="text" id="userPhone" class="form-control" placeholder="請輸入電話" />
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">公司/團體/旅行社：</label>
                <input type="text" id="company" class="form-control" placeholder="選填" />
            </div>

            <div class="row mb-3">
                <div class="col-md-3">
                    <label class="form-label">是否需要導覽：</label>
                    <select id="guide" class="form-select">
                        <option>是</option>
                        <option>否</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">遊覽車數量：</label>
                    <input type="number" id="busCount" value="0" min="0" class="form-control" />
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">備註：</label>
                <textarea id="note" class="form-control" rows="3" placeholder="特殊需求請填寫"></textarea>
            </div>

            <div class="text-end">
                <button class="btn btn-secondary">取消</button>
                <button type="button" class="btn btn-primary" onclick="previewBooking()">送出預約</button>
            </div>
        </div>
    </div>
</div>

<!-- 📌 預覽確認 Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">🔍 預約確認</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered">
                    <tbody>
                        <tr><th>日期</th><td id="p_date"></td></tr>
                        <tr><th>地區</th><td id="p_area"></td></tr>
                        <tr><th>票種/張數</th><td id="p_tickets"></td></tr>
                        <tr><th>總人數</th><td id="p_total"></td></tr>
                        <tr><th>姓名</th><td id="p_name"></td></tr>
                        <tr><th>電話</th><td id="p_phone"></td></tr>
                        <tr><th>公司/團體</th><td id="p_company"></td></tr>
                        <tr><th>是否需要導覽</th><td id="p_guide"></td></tr>
                        <tr><th>遊覽車數量</th><td id="p_bus"></td></tr>
                        <tr><th>備註</th><td id="p_note"></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">返回修改</button>
                <button class="btn btn-success">確認送出</button>
            </div>
        </div>
    </div>
</div>

<script>
    function previewBooking() {
        let ticketSummary = [];
        let total = 0;

        // 一般票
        let normal = parseInt(document.getElementById("normalCount").value) || 0;
        let discount = parseInt(document.getElementById("discountCount").value) || 0;
        if (normal > 0) ticketSummary.push(`一般票：${normal} 張`);
        if (discount > 0) ticketSummary.push(`優待票：${discount} 張`);
        total += normal + discount;

        // DIY 體驗票 (分時段)
        let rows = document.querySelectorAll("input[data-time]");
        rows.forEach(row => {
            let count = parseInt(row.value) || 0;
            if (count > 0) {
                let time = row.dataset.time;
                let remainId = "remain_" + time.replace(":", "");
                let remainEl = document.getElementById(remainId);
                let remain = parseInt(remainEl.innerText);
                remainEl.innerText = remain - count; // 扣掉剩餘
                ticketSummary.push(`DIY ${time}：${count} 張 (剩餘 ${remain - count})`);
                total += count;
            }
        });

        // 填入 Modal
        document.getElementById("p_date").innerText = document.getElementById("date").value;
        document.getElementById("p_area").innerText = document.getElementById("area").value;
        document.getElementById("p_tickets").innerHTML = ticketSummary.join("<br/>");
        document.getElementById("p_total").innerText = total;
        document.getElementById("p_name").innerText = document.getElementById("userName").value;
        document.getElementById("p_phone").innerText = document.getElementById("userPhone").value;
        document.getElementById("p_company").innerText = document.getElementById("company").value;
        document.getElementById("p_guide").innerText = document.getElementById("guide").value;
        document.getElementById("p_bus").innerText = document.getElementById("busCount").value;
        document.getElementById("p_note").innerText = document.getElementById("note").value;

        new bootstrap.Modal(document.getElementById('previewModal')).show();
    }
</script>
