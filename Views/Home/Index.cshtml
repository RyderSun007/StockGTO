@model StockGTO.ViewModels.HomeViewModel
@using System.Linq

@{
    ViewData["Title"] = "StockGTO | 股市周刊";
    Layout = "~/Views/Shared/_AzNewsLayout.cshtml";

    var newsList = Model.IndexNews
        .Where(x => x.IsActive)
        .OrderByDescending(x => x.CreatedAt)
        .Take(10)
        .ToList();

    var main = newsList.FirstOrDefault(x => x.Position == 1);


    // 這裡加上Random
    var random = new Random();
    var shuffledArticles = Model.ArticlePosts.OrderBy(x => random.Next()).Take(6).ToList();
}






<!-- 🔔 跑馬燈區塊 Start -->
<div class="bg-warning py-2 px-3 text-dark" style="overflow: hidden; white-space: nowrap;">
    <marquee behavior="scroll" direction="left" scrollamount="5">
        @foreach (var news in newsList)
        {
            <span class="mx-3">
                🗞️ <a href="@news.LinkUrl" target="_blank" class="text-dark fw-bold">@news.Title</a>
            </span>
        }
    </marquee>
</div>
<!-- 🔔 跑馬燈區塊 End -->






<!-- 🌟【首頁熱門區塊 Trending Area】Start -->
<div class="trending-area fix">
    <div class="container">
        <div class="trending-main">
            <div class="row align-items-start">
                <!-- 🔶 主圖 + 下方三卡（Position 1~4） -->
                <div class="col-lg-8 d-flex flex-column justify-content-between" style="min-height: 600px;">
                    <!-- 📌 主圖 Position = 1 -->
                    @if (main != null)
                    {
                        <div class="trending-top mb-3">
                            <div class="trend-top-img">
                                <a href="@main.LinkUrl" target="_blank">
                                    <img src="@main.ImageUrl" alt="@main.Title" class="img-fluid" style="width:100%; height:auto;" />
                                </a>
                                <div class="trend-top-cap">
                                    <span class="badge bg-warning text-dark">主題專欄</span>
                                    <h2><a href="@main.LinkUrl" target="_blank">@main.Title</a></h2>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- 📌 下三卡 Position = 2~4 -->
                    <div class="trending-bottom mt-auto">
                        <div class="row">
                            @foreach (var item in newsList.Where(n => n.Position >= 2 && n.Position <= 4 && n.IsActive))
                            {
                                <div class="col-lg-4 d-flex">
                                    <div class="single-bottom mb-3 w-100">
                                        <div class="trend-bottom-img mb-2">
                                            <a href="@item.LinkUrl" target="_blank">
                                                <img src="@item.ImageUrl" alt="@item.Title" class="img-fluid"
                                                     style="width:100%; height:120px; object-fit:cover;" />
                                            </a>
                                        </div>
                                        <div class="trend-bottom-cap">
                                            <span class="badge bg-dark text-light">主題專欄</span>
                                            <h4 style="font-size:1rem;">
                                                <a href="@item.LinkUrl" target="_blank">@item.Title</a>
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- 🔷 右五卡 Position = 5~9 -->
                <div class="col-lg-4">
                    <div class="trand-right">
                        @foreach (var item in newsList.Where(n => n.Position >= 5 && n.Position <= 9 && n.IsActive))
                        {
                            <div class="trand-right-single d-flex mb-3">
                                <div class="trand-right-img">
                                    <a href="@item.LinkUrl" target="_blank">
                                        <img src="@item.ImageUrl" alt="@item.Title" class="img-fluid"
                                             style="width:100px; height:80px; object-fit:cover;" />
                                    </a>
                                </div>
                                <div class="trand-right-cap ps-3">
                                    <span class="badge bg-light text-dark mb-1">主題專欄</span>
                                    <h4 class="mb-0" style="font-size:1rem; line-height:1.4;">
                                        <a href="@item.LinkUrl" target="_blank">@item.Title</a>
                                    </h4>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div> <!-- .trending-main -->
    </div> <!-- .container -->
</div>
<!-- 🌟【首頁熱門區塊 Trending Area】End -->
<!-- 🔥 熱門文章排行輪播區塊 Start -->

<div class="weekly-news-area pt-50">
    <div class="container">
        <div class="weekly-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-tittle mb-30">
                        <h3>🔥 熱門文章排行</h3>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="weekly-news-active dot-style d-flex">
                        @foreach (var article in Model.TopViewedArticles)
                        {
                            <div class="weekly-single position-relative">
                                <div class="weekly-img">
                                    <img src="@(!string.IsNullOrEmpty(article.ImageUrl) ? article.ImageUrl : "/images/default.jpg")"
                                         alt="@article.Title"
                                         class="w-100"
                                         style="object-fit: cover; height: 200px;" />
                                </div>
                                <div class="overlay-caption">
                                    <span class="badge bg-light text-dark mb-1">@article.Category?.Name</span>
                                    <h5 class="text-dark fw-bold mb-0" style="font-size: 1rem;">
                                        <a asp-controller="KnowledgeArticle"
                                           asp-action="Details"
                                           asp-route-id="@article.Id"
                                           class="text-dark">
                                            @article.Title
                                        </a>
                                    </h5>
                                    <small class="text-muted">👁️ 點閱 @article.ViewCount</small>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 🔥 熱門文章排行輪播區塊 End -->
<!-- 🔄 Weekly Top News 改為隨機文章輪播 -->
<div class="weekly-news-area pt-50">
    <div class="container">
        <div class="weekly-wrapper">
            <!-- section Tittle -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-tittle mb-30">
                        <h3>隨機文章輪播</h3>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="weekly-news-active dot-style d-flex dot-style">
                        @foreach (var article in shuffledArticles)
                        {
                            <div class="weekly-single">
                                <div class="weekly-img">
                                    <img src="@(!string.IsNullOrEmpty(article.ImageUrl) ? article.ImageUrl : "/images/default.jpg")"
                                         alt="@article.Title"
                                         style="object-fit: cover; height: 200px;" />
                                </div>
                                <div class="weekly-caption">
                                    <span class="color1">@article.Category?.Name ?? "其他分類"</span>
                                    <h4>
                                        <a asp-controller="KnowledgeArticle"
                                           asp-action="Details"
                                           asp-route-id="@article.Id">
                                            @article.Title
                                        </a>
                                    </h4>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>






<!-- ✅ 推播區建議 class 命名統一為 signalr-articles-wrapper + signalr-articles -->
<section class="signalr-articles-wrapper">
    <div class="container">
        <div class="section-tittle mb-30">
            <h3><i class="fa fa-bolt"></i> WebSocket推播最新文章</h3>
        </div>
        <div class="row signalr-articles gy-4">
            <!-- SignalR 插入文章卡片 -->
        </div>
    </div>
</section>













<!-- 右側快訊與 Follow Us 保留 -->
<!-- 🌟 改版：熱門新聞區塊 Start -->
<section class="whats-news-area pt-50 pb-20">
    <div class="container">
        <div class="row">
            <!-- 左側新聞內容 -->
            <div class="col-lg-8">
                <div class="row d-flex justify-content-between">
                    <div class="col-lg-3 col-md-3">
                        <div class="section-tittle mb-30">
                            <h3>熱門新聞</h3>
                        </div>
                    </div>
                    <div class="col-lg-9 col-md-9">
                        <div class="properties__button">
                            <!-- ✅ 改名的 Nav Tabs -->
                            <nav>
                                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">台股</a>
                                    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">美股</a>
                                    <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">港股</a>
                                    <a class="nav-item nav-link" id="nav-last-tab" data-toggle="tab" href="#nav-last" role="tab" aria-controls="nav-last" aria-selected="false">外匯</a>
                                    <a class="nav-item nav-link" id="nav-Sports" data-toggle="tab" href="#nav-fund" role="tab" aria-controls="nav-fund" aria-selected="false">基金</a>
                                    <a class="nav-item nav-link" id="nav-technology" data-toggle="tab" href="#nav-realestate" role="tab" aria-controls="nav-realestate" aria-selected="false">房地產</a>
                                </div>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- ✅ Tab 區塊內容（保留原有結構即可） -->
                <div class="row">
                    <div class="col-12">
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                                <div class="whats-news-caption">
                                    <div class="row" id="dynamic-news-area">
                                        <!-- 對應分類代碼：TaiwanMarket 的資料插入區 -->
                                    </div>
                                </div>
                            </div>
                            <!-- 其他 tab-pane 保留結構不動，只需改 href / id 名稱與註解 -->
                            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                                <!-- 分類代碼：USMarket -->
                            </div>
                            <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                                <!-- 分類代碼：HKMarket -->
                            </div>
                            <div class="tab-pane fade" id="nav-last" role="tabpanel" aria-labelledby="nav-last-tab">
                                <!-- 分類代碼：Forex -->
                            </div>
                            <div class="tab-pane fade" id="nav-fund" role="tabpanel" aria-labelledby="nav-Sports">
                                <!-- 分類代碼：Fund -->
                            </div>
                            <div class="tab-pane fade" id="nav-realestate" role="tabpanel" aria-labelledby="nav-technology">
                                <!-- 分類代碼：RealEstate -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右側快訊與 Follow Us 保留 -->
            <!-- 右側快訊與 Follow Us 保留 -->
            <div class="col-lg-4">

                <!-- 🔥 熱門快訊區塊 -->
                <div class="hot-news-container p-3 shadow-sm rounded bg-white mb-4">
                    <h5 class="mb-3 fw-bold text-danger">
                        🔥 熱門快訊 (Python)
                    </h5>
                    <div id="hot-news-box">
                        <!-- JS 動態載入 JSON 資料 -->
                    </div>
                </div>

                <!-- 🌐 Follow Us 區塊 -->
                <div class="section-tittle mb-40">
                    <h2>Follow Us</h2>
                </div>

                <div class="single-follow mb-45">
                    <div class="single-box">
                        <div class="follow-us d-flex align-items-center mb-2">
                            <div class="follow-social me-2">
                                <a href="#"><img src="~/aznews/assets/img/news/icon-fb.png" asp-append-version="true" alt="Facebook" /></a>
                            </div>
                            <div class="follow-count">
                                <span>8,045</span>
                                <p>Fans</p>
                            </div>
                        </div>

                        <div class="follow-us d-flex align-items-center mb-2">
                            <div class="follow-social me-2">
                                <a href="#"><img src="~/aznews/assets/img/news/icon-tw.png" asp-append-version="true" alt="Twitter" /></a>
                            </div>
                            <div class="follow-count">
                                <span>8,045</span>
                                <p>Fans</p>
                            </div>
                        </div>

                        <div class="follow-us d-flex align-items-center mb-2">
                            <div class="follow-social me-2">
                                <a href="#"><img src="~/aznews/assets/img/news/icon-ins.png" asp-append-version="true" alt="Instagram" /></a>
                            </div>
                            <div class="follow-count">
                                <span>8,045</span>
                                <p>Fans</p>
                            </div>
                        </div>

                        <div class="follow-us d-flex align-items-center">
                            <div class="follow-social me-2">
                                <a href="#"><img src="~/aznews/assets/img/news/icon-yo.png" asp-append-version="true" alt="YouTube" /></a>
                            </div>
                            <div class="follow-count">
                                <span>8,045</span>
                                <p>Fans</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
</section>
<!-- 🌟 改版：熱門新聞區塊 End -->


<!-- 📈 台股新聞 TaiwanMarket 區塊 Start -->
@{
    var taiwanNews = Model.CategoryArticles.ContainsKey("台股")
        ? Model.CategoryArticles["台股"].Take(8).ToList()
        : new List<ArticlePost>();
}

<div class="weekly-news-area pt-50">
    <div class="container">
        <div class="weekly-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-tittle mb-30">
                        <h3>📈 台股新聞 TaiwanMarket</h3>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="weekly-news-active dot-style d-flex">
                        @foreach (var article in taiwanNews)
                        {
                            <div class="weekly-single position-relative">
                                <div class="weekly-img">
                                    <a asp-controller="KnowledgeArticle"
                                       asp-action="Details"
                                       asp-route-id="@article.Id">
                                        <img src="@(!string.IsNullOrEmpty(article.ImageUrl) ? article.ImageUrl : "/images/default.jpg")"
                                             alt="@article.Title"
                                             class="w-100"
                                             style="object-fit: cover; height: 200px;" />
                                    </a>
                                </div>
                                <div class="overlay-caption">
                                    <span class="badge bg-light text-dark mb-1">@article.Category?.Name</span>
                                    <h5 class="text-dark fw-bold mb-0" style="font-size: 1rem;">
                                        <a asp-controller="KnowledgeArticle"
                                           asp-action="Details"
                                           asp-route-id="@article.Id"
                                           class="text-dark">
                                            @article.Title
                                        </a>
                                    </h5>
                                    <small class="text-muted">👁️ @article.ViewCount 次瀏覽</small>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 📈 台股新聞 TaiwanMarket 區塊 End -->
<!-- 台股 國際 ETF區塊  -->
@{
    var sections = new Dictionary<string, string>
    {
        { "台股", "📈 台股新聞 TaiwanMarket" },
        { "國際", "🌍 國際新聞 GlobalMarket" },
        { "ETF", "📊 ETF 精選專欄" }
    };
}

@foreach (var section in sections)
{
    var code = section.Key;
    var title = section.Value;

    var articles = Model.CategoryArticles.ContainsKey(code)
        ? Model.CategoryArticles[code].Take(8).ToList()
        : new List<ArticlePost>();

    <div class="weekly-news-area pt-50">
        <div class="container">
            <div class="weekly-wrapper">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="section-tittle mb-30">
                            <h3>@title</h3>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="weekly-news-active dot-style d-flex">
                            @foreach (var article in articles)
                            {
                                <div class="weekly-single position-relative">
                                    <div class="weekly-img">
                                        <a asp-controller="KnowledgeArticle"
                                           asp-action="Details"
                                           asp-route-id="@article.Id">
                                            <img src="@(!string.IsNullOrEmpty(article.ImageUrl) ? article.ImageUrl : "/images/default.jpg")"
                                                 alt="@article.Title"
                                                 class="w-100"
                                                 style="object-fit: cover; height: 200px;" />
                                        </a>
                                    </div>
                                    <div class="overlay-caption">
                                        <span class="badge bg-light text-dark mb-1">@article.Category?.Name</span>
                                        <h5 class="text-dark fw-bold mb-0" style="font-size: 1rem;">
                                            <a asp-controller="KnowledgeArticle"
                                               asp-action="Details"
                                               asp-route-id="@article.Id"
                                               class="text-dark">
                                                @article.Title
                                            </a>
                                        </h5>
                                        <small class="text-muted">👁️ @article.ViewCount 次瀏覽</small>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<!-- 台股 國際 ETF區塊 End -->










































<!-- Start Youtube -->
        <div class="youtube-area video-padding">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="video-items-active">
                            <div class="video-items text-center">
                        <iframe src="https://www.youtube.com/embed/m_dhMSvUCIc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <div class="video-items text-center">
                        <iframe src="https://www.youtube.com/embed/V1p33hqPrUk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <div class="video-items text-center">
                        <iframe src="https://www.youtube.com/embed/AEBeWMM1atA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                            </div>
                            <div class="video-items text-center">
                        <iframe src="https://www.youtube.com/embed/6YLkmv0_-EE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                            </div>
                            <div class="video-items text-center">
                        <iframe src="https://www.youtube.com/embed/6IquAgfvYmc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="video-info">    
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="video-caption">
                                <div class="top-caption">
                                    <span class="color1">Politics</span>
                                </div>
                                <div class="bottom-caption">
                                    <h2>新聞直播</h2>
                                    <p>各大新聞台 </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="testmonial-nav text-center">
                                <div class="single-video">
                            <iframe src="https://www.youtube.com/embed/m_dhMSvUCIc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    <div class="video-intro">
                                        <h4>TVBS NEWSt</h4>
                                    </div>
                                </div>
                                <div class="single-video">
                            <iframe src="https://www.youtube.com/embed/V1p33hqPrUk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    <div class="video-intro">
                                        <h4>東森新聞</h4>
                                    </div>
                                </div>
                                <div class="single-video">
                            <iframe src="https://www.youtube.com/embed/AEBeWMM1atA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    <div class="video-intro">
                                        <h4>EBC東森財經股市</h4>
                                    </div>
                                </div>
                                <div class="single-video">
                            <iframe src="https://www.youtube.com/embed/6YLkmv0_-EE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    <div class="video-intro">
                                        <h4> 非凡商業台 </h4>
                                    </div>
                                </div>
                                <div class="single-video">
                            <iframe src="https://www.youtube.com/embed/6IquAgfvYmc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    <div class="video-intro">
                                        <h4>寰宇新聞台 </h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Start youtube -->

<!-- ✅ 推播區建議 class 命名統一為 signalr-articles-wrapper + signalr-articles -->
<section class="signalr-articles-wrapper">
    <div class="container">
        <div class="section-tittle mb-30">
            <h3><i class="fa fa-bolt"></i> WebSocket推播最新文章</h3>
        </div>
        <div class="row signalr-articles gy-4">
            <!-- SignalR 插入文章卡片 -->
        </div>
    </div>
</section>



    <!-- JS here -->
    <!-- JS here -->
    <!-- All JS Custom Plugins Link Here here -->
<script src="~/aznews/assets/js/vendor/modernizr-3.5.0.min.js" asp-append-version="true"></script>

    <!-- Jquery, Popper, Bootstrap -->
<script src="~/aznews/assets/js/vendor/jquery-1.12.4.min.js" asp-append-version="true"></script>
    
<script src="~/aznews/assets/js/bootstrap.min.js" asp-append-version="true"></script>

    <!-- Jquery Mobile Menu -->
<script src="~/aznews/assets/js/jquery.slicknav.min.js" asp-append-version="true"></script>

    <!-- Jquery Slick , Owl-Carousel Plugins -->
<script src="~/aznews/assets/js/owl.carousel.min.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/slick.min.js" asp-append-version="true"></script>

    <!-- Date Picker -->
<script src="~/aznews/assets/js/gijgo.min.js" asp-append-version="true"></script>

    <!-- One Page, Animated-HeadLine -->
<script src="~/aznews/assets/js/wow.min.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/animated.headline.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/jquery.magnific-popup.js" asp-append-version="true"></script>

    <!-- Breaking News Plugin -->
<script src="~/aznews/assets/js/jquery.ticker.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/site.js" asp-append-version="true"></script>

    <!-- Scrollup, nice-select, sticky -->
<script src="~/aznews/assets/js/jquery.scrollUp.min.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/jquery.nice-select.min.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/jquery.sticky.js" asp-append-version="true"></script>

    <!-- contact js -->
<script src="~/aznews/assets/js/contact.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/jquery.form.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/jquery.validate.min.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/mail-script.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/jquery.ajaxchimp.min.js" asp-append-version="true"></script>

    <!-- Jquery Plugins, main Jquery -->
<script src="~/aznews/assets/js/plugins.js" asp-append-version="true"></script>
<script src="~/aznews/assets/js/main.js" asp-append-version="true"></script>
<!-- ✅ 1. 頁面載入後：讀取 JSON 檔案，顯示前 4 筆 Python 新聞卡片 -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('/data/news_data.json') // 讀取本地 JSON 資料
          .then(res => res.json())
          .then(newsList => {
            const container = document.getElementById('dynamic-news-area'); // 對應 ID 區塊
            if (!container) return;

            container.innerHTML = ''; // 清空舊內容

            // 顯示前 4 筆新聞（左側 Tab 內容）
            newsList.slice(0, 4).forEach(item => {
              const imageUrl = item.image && item.image.trim() !== ''
                ? item.image
                : 'https://via.placeholder.com/400x250?text=News+Image';

              const card = document.createElement('div');
              card.className = 'col-lg-6 col-md-6'; // 每欄兩張
              card.innerHTML = `
                <div class="single-what-news mb-100">
                  <div class="what-img">
                    <img src="${imageUrl}" alt="新聞圖片" />
                  </div>
                  <div class="what-cap">
                    <span class="color1">Python新聞</span>
                    <h4><a href="${item.link}" target="_blank">${item.title}</a></h4>
                  </div>
                </div>
              `;
              container.appendChild(card);
            });
          });
    });
</script>

<!-- ✅ 2. 載入右側「熱門快訊」：最多顯示 11 筆文字清單 -->
<script>
    fetch("/data/news_data.json")
        .then(res => res.json())
        .then(data => {
            const box = document.getElementById("hot-news-box"); // 右側區塊容器
            let html = "";
            const items = data.slice(0, 11); // 顯示最多 11 筆

            items.forEach(item => {
                const title = item.title.length > 40 ? item.title.slice(0, 40) + "..." : item.title;
                html += `
                    <a href="${item.link}" target="_blank" title="${item.title}">
                        🔸 ${title}
                    </a>`;
            });
            box.innerHTML = html;
        })
        .catch(err => console.error("❌ 載入 JSON 失敗：", err));
</script>

<!-- ✅ 3. 引入 SignalR 套件（WebSocket 支援） -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<!-- 🔁 自動插入文章卡片的函式 -->
<script>
    function renderSignalRCards(articles) {
        const container = document.querySelector(".signalr-articles");
        if (!container) return;

        container.innerHTML = "";

        articles.slice(0, 9).forEach(article => {
            const imageUrl = article.imageUrl?.trim() || "https://via.placeholder.com/400x250?text=No+Image";
            const html = `
          <div class="col-md-6 col-lg-4">
            <a href="/KnowledgeArticle/Details/${article.id}" class="text-dark text-decoration-none">
              <div class="card signalr-card h-100">
                <img src="${imageUrl}" class="card-img-top" alt="文章封面" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                    <h6 class="text-muted mb-1">${article.categoryName}</h6>
                    <h5 class="card-title">${article.title}</h5>
                </div>
              </div>
            </a>
          </div>`;
            container.innerHTML += html;
        });
    }
</script>




<!-- ✅ 4. 使用 SignalR 即時推播文章區塊（卡片樣式） -->
<script>
    // 建立 WebSocket 連線
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/articleHub") // 必須對應後端的 Hub 路徑
        .build();

    // 監聽後端的推播事件 "ReceiveArticles"
    connection.on("ReceiveArticles", function (articles) {
        console.log("📡 接收到文章清單", articles);

        const container = document.querySelector(".signalr-articles");
        if (!container) return console.warn("⚠️ 找不到 .signalr-articles");

        container.innerHTML = ""; // 清空舊內容

        // 顯示 9 筆 SignalR 推播文章
        articles.slice(0, 9).forEach(article => {
            const imageUrl = article.imageUrl?.trim() || "https://via.placeholder.com/400x250?text=No+Image";
            const html = `
      <div class="col-md-6 col-lg-4">
        <a href="/KnowledgeArticle/Details/${article.id}" class="text-dark text-decoration-none">
          <div class="card signalr-card h-100">
            <img src="${imageUrl}" class="card-img-top" alt="文章封面"
                 style="height: 200px; object-fit: cover;">
            <div class="card-body">
                <h6 class="text-muted mb-1">${article.categoryName}</h6>
                <h5 class="card-title">${article.title}</h5>
            </div>
          </div>
        </a>
      </div>
    `;
            container.innerHTML += html;
        });
    });

    // 啟動連線，並觸發後端一次推播文章（載入即有內容）
    connection.start()
        .then(() => {
            console.log("✅ SignalR 已成功連線");

            // 首次觸發
                // ✅ 頁面一載入就先抓資料，立刻顯示（不等 WebSocket）
                    fetch("/Home/PushArticles")
                        .then(res => res.json())
                        .then(articles => {
                            renderSignalRCards(articles); // 用你現在的插入邏輯 // 直接插入卡片
                                           })
                        .catch(err => console.error("❌ 預抓失敗", err));

            // 每 30 秒再呼叫一次後端觸發推播
            setInterval(() => {
                fetch("/Home/PushArticles")
                    .then(res => res.json())
                    .then(data => console.log("🔁 自動推播成功", data))
                    .catch(err => console.error("❌ 推播失敗", err));
            }, 30000); // 30 秒
        })
        .catch(err => console.error("❌ SignalR 連線失敗", err));
</script>
