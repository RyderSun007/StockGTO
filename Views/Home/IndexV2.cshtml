@model StockGTO.ViewModels.HomeViewModel
@using System.Linq

@{
    ViewData["Title"] = "StockGTO | 股市周刊";
    Layout = "~/Views/Shared/_AzNewsLayout.cshtml";

    var newsList = Model.IndexNews
        .Where(x => x.IsActive)
        .OrderByDescending(x => x.CreatedAt)
        .Take(10)
        .ToList();

    var main = newsList.FirstOrDefault(x => x.Position == 1);


    // 這裡加上Random
    var random = new Random();
    var shuffledArticles = Model.ArticlePosts.OrderBy(x => random.Next()).Take(6).ToList();
}
<!-- ✅ 推播區建議 class 命名統一為 signalr-articles-wrapper + signalr-articles -->
<section class="signalr-articles-wrapper">
    <div class="container">
        <div class="section-tittle mb-30">
            <h3><i class="fa fa-bolt"></i> AI 推播最新文章</h3>
        </div>
        <div class="row signalr-articles gy-4">
            <!-- SignalR 插入文章卡片 -->
        </div>
    </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
      .withUrl("/articleHub")
      .build();

    connection.on("ReceiveArticles", function (articles) {
      const container = document.querySelector(".signalr-articles");
      if (!container) return;
      container.innerHTML = "";
      articles.forEach(article => {
        const html = `<div class="col-md-6 col-lg-4">
          <div class="card shadow-sm border-0 h-100">
              <img src="${article.imageUrl}" class="card-img-top" alt="文章封面">
              <div class="card-body">
                  <h6 class="text-muted mb-1">${article.categoryName}</h6>
                  <h5 class="card-title">
                      <a href="/KnowledgeArticle/Details/${article.id}" class="stretched-link text-dark">
                          ${article.title}
                      </a>
                  </h5>
              </div>
          </div>
        </div>`;
        container.innerHTML += html;
      });
    });

    connection.start().then(() => {
      console.log("✅ SignalR 連線成功");
    }).catch(err => console.error("❌ SignalR 失敗", err));
</script>
